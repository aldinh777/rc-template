import { counter, urmom, todo, todoIsEmpty, mainColor } from '../store';

const sidebar = stateLocalStorage('testing_sidebar', 'counter');
const btnColor = stateObserve(mainColor, color => 'btn ' + color);
const sideItems = [
    {
        title: 'Counter',
        value: 'counter'
    },
    {
        title: "Your Mom's name",
        value: 'urmom'
    },
    {
        title: 'To do List',
        value: 'todolist',
    }
];

const todoInput = state('');
const todoMapped = mapview(todo, (item) => ({
    item: item,
    delete() {
        const index = todo.raw.indexOf(item);
        if (index !== -1) {
            todo.splice(index, 1);
        }
    }
}));
todoInput.onChange((item, prev) => {
    if (item) {
        todo.push(item);
    }
    todoInput.value = '';
});

function addCounter() {
    counter.value++;
}

div <
    div class="row container" <
        div class="col s4" <
            SideBar title="Testing" bind:items="sideItems" bind:sideState="sidebar" bind:color="mainColor" <>
        >
        div class="col s8" <
            div class="card-panel" <
                if state:val="sidebar" equal="counter" <
                    h4 <Counter>
                    Click Counter : {counter} br<>
                    button bind:class="btnColor" on:click="addCounter" <Increase>
                >
                if state:val="sidebar" equal="urmom" <
                    h4 <Your Mom's name>
                    Your mom : b<{urmom}> br <>
                    InputField name="urmom" type="text" bind:value="urmom" <
                        Fill to change your mom:
                    >
                >
                if state:val="sidebar" equal="todolist" <
                    h4 <To do List>
                    if state:val="todoIsEmpty" <
                        * todo list is empty *
                    >
                    unless state:val="todoIsEmpty" <
                        div class="collection" <
                            foreach collect:list="todoMapped" destruct="item delete" <
                                div class="collection-item row valign-wrapper" <
                                    div class="col s8" <{item}>
                                    div class="col s4 right-align" <
                                        button bind:class="btnColor" on:click="delete" <delete>
                                    >
                                >
                            >
                        >
                    >
                    InputField name="todo" type="text" bind:value="todoInput" <
                        press enter to add something
                    >
                >
            >
        >
    >
>